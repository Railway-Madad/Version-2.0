<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Lost/Found Items</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
<main class="page-shell fade-in">
  <header class="page-header">
    <div style="display:flex;align-items:center;gap:1rem">
      <span class="badge">Rail Madad</span>
      <h1 style="margin:0">Lost and Found Items</h1>
    </div>
    <div class="actions-inline">
      <a class="btn btn-ghost" href="index.html">Home</a>
      <a class="btn btn-tonal" href="userDashboard.html">Dashboard</a>
      <a class="btn btn-ghost" href="lostnfound.html">Submit Lost/Found</a>
    </div>
  </header>
  <section class="surface-card card-highlight" style="max-width:420px;margin:0 auto 2rem auto;">
    <div class="input-group">
      <label for="filter">Filter by Category</label>
      <select id="filter" class="form-select" style="margin-top:0.35rem;" onchange="loadItems()">
        <option value="">All</option>
        <option value="Lost">Lost</option>
        <option value="Found">Found</option>
      </select>
    </div>
  </section>
  <section class="surface-card" style="max-width:850px;margin:0 auto;">
    <h2 class="card-section-title" style="margin-bottom:0.6rem;">Results</h2>
    <div id="user-submissions" class="list-card"></div>
  </section>
  <footer style="margin-top:2.5rem;text-align:center;">
    <p class="muted-text">Â© 2025 Rail Madad - Indian Railways. All Rights Reserved.</p>
  </footer>
</main>
<script>
const API_BASE = "http://localhost:4000";
async function loadItems() {
    const token = localStorage.getItem("token");
    if (!token) {
        window.location.href = "login.html";
        return;
    }
    const filter = document.getElementById("filter").value;
    let url = `${API_BASE}/lostnfound`;
    const res = await fetch(url, { headers: { "Authorization": `Bearer ${token}` } });
    const result = await res.json();
    const container = document.getElementById("user-submissions");
    container.innerHTML = "";
    let items = res.ok && result.items ? result.items : [];
    if (filter) {
        items = items.filter(item => item.category === filter);
    }
    if (items.length) {
        items.forEach(item => {
          const div = document.createElement("article");
          div.className = "list-card-item";
          div.innerHTML = `
             <h3 style='margin-bottom:0.4rem'>${item.title} <span class='badge-neutral' style='font-size:13px'>${item.category}</span></h3>
             <p class='muted-text'>${item.description}</p>
             <p><span class='badge'>Date</span> ${new Date(item.date).toLocaleDateString()} | <span class='badge'>Location</span> ${item.location}</p>
             <p class='muted-text'><b>Contact Info:</b> ${item.contactInfo ? item.contactInfo : "N/A"}</p>
             ${item.imageUrl ? `<img src="${item.imageUrl}" style='max-width:110px;border-radius:8px;margin-top:8px;'>` : ""}
             <span class='status-pill ${item.status==="resolved"?"success":"warning"}'>${item.status}</span>
          `;
          container.appendChild(div);
        });
    } else {
        container.innerHTML = `<div class='empty-state'>No items found for this category.</div>`;
    }
}
loadItems();
</script>
</body>
</html>
