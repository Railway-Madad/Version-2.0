<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lost and Found</title>
</head>
<body>
    <h1>Lost and Found</h1>
    <p>This is the Lost and Found page.</p>

    <a href="userDashboard.html">Back to Dashboard</a>
    <a href="lostnfoundView.html">View Lost/Found Items</a>
    <form id="lost-found-form">
        <h2>Submit a Lost/Found Item</h2>

        <label for="title">Item Name:</label><br>
        <input type="text" id="title" name="title" required><br><br>

        <label for="description">Description:</label><br>
        <textarea id="description" name="description" required></textarea><br><br>

        <label for="category">Category:</label><br>
        <select id="category" name="category" required>
            <option value="Lost">Lost</option>
            <option value="Found">Found</option>
        </select><br><br>

        <label for="date">Date Lost/Found:</label><br>
        <input type="date" id="date" name="date" required><br><br>

        <label for="location">Location:</label><br>
        <input type="text" id="location" name="location" required><br><br>

        <label for="image">Image (optional):</label><br>
        <input type="file" id="image" name="image"><br><br>

        <button type="submit">Submit</button>

   
    </form>
     // show user submissions
    <h2>Your Submissions</h2>
    <div id="user-submissions"></div>

    <script>
        const API_BASE = "http://localhost:4000";

        document.getElementById("lost-found-form").addEventListener("submit", async function(event) {
            event.preventDefault();

            const token = localStorage.getItem("token");
            if (!token) {
                alert("Please log in to submit an item.");
                return;
            }

            const formData = new FormData(this);

            const res = await fetch(`${API_BASE}/lostnfound`, {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${token}`
                },
                body: formData
            });

            const result = await res.json();
            if (res.ok) {
                alert("Item submitted successfully!");
                loadUserSubmissions();
                this.reset();
            } else {
                alert("Error: " + result.message);
            }
        });
        async function loadUserSubmissions() {
            const token = localStorage.getItem("token");
            if (!token) return;

            const res = await fetch(`${API_BASE}/lostnfound/myitems`, {
                headers: { "Authorization": `Bearer ${token}` }
            });

            const result = await res.json();
            const container = document.getElementById("user-submissions");
            container.innerHTML = "";
            console.log(result);

            if (res.ok) {
                result.items.forEach(item => {
                    const div = document.createElement("div");
                    div.style.border = "1px solid black";
                    div.style.margin = "10px";
                    div.style.padding = "10px";

                    div.innerHTML = `
                        <h3>${item.title} (${item.category})</h3>
                        <p>${item.description}</p>
                        <p><strong>Date:</strong> ${new Date(item.date).toLocaleDateString()}</p>
                        <p><strong>Location:</strong> ${item.location}</p>
                        <p><strong>Status:</strong> ${item.status}</p>
                        ${item.imageUrl ? `<img src="${item.imageUrl}" width="100">` : ""}
                        <button onclick="markAsResolved('${item._id}')">Mark as Resolved</button>
                        <button onclick="deleteItem('${item._id}')">Delete</button>
                    `;
                    container.appendChild(div);
                });
            } else {
                container.innerText = "Error loading submissions: " + result.message;
            }

        }

        async function markAsResolved(id) {
            const token = localStorage.getItem("token");
            if (!token) return;

            const res = await fetch(`${API_BASE}/lostnfound/${id}/resolve`, {
                method: "PUT",
                headers: { "Authorization": `Bearer ${token}` }
            });

            const result = await res.json();
            if (res.ok) {
                alert("Item marked as resolved.");
                loadUserSubmissions();
            } else {
                alert("Error: " + result.message);
            }
        }
        async function deleteItem(id) {
            const token = localStorage.getItem("token");
            if (!token) return;

            const res = await fetch(`${API_BASE}/lostnfound/${id}`, {
                method: "DELETE",
                headers: { "Authorization": `Bearer ${token}` }
            });

            const result = await res.json();
            if (res.ok) {
                alert("Item deleted.");
                loadUserSubmissions();
            } else {
                alert("Error: " + result.message);
            }
        }
        loadUserSubmissions();

    </script>
</body>
</html>

