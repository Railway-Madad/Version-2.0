<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <div class="container">
        <h2>User Dashboard</h2>

        <p id="welcome"></p>
        <a href="complaint.html">File a Complaint</a>
        <a href="order.html">food order</a>
        <a href="emergency.html">Emergency Request</a>
        <button onclick="logout()">Logout</button>
    </div>
    <div>
        <h1>Latest News & Updates</h1>
  <div id="news-section"></div>
    </div>
    <script>
        async function loadDashboard() {
            const token = localStorage.getItem("token");
            if (!token) {
                window.location.href = "login.html";
                return;
            }

            const res = await fetch("http://localhost:4000/", {
                headers: { "Authorization": `Bearer ${token}` }
            });

            if (res.ok) {
                const data = await res.json();
                document.getElementById("welcome").innerText = `Hello, ${data.username}!`;
            } else {
                localStorage.removeItem("token");
                window.location.href = "login.html";
            }
        }

        function logout() {
            localStorage.removeItem("token");
            window.location.href = "login.html";
        }

        loadDashboard();
    </script>

    <script>
        const API_BASE = "http://localhost:4000";

    async function loadNews() {
      const res = await fetch(`${API_BASE}/news`);
      const data = await res.json();
      const container = document.getElementById("news-section");
      container.innerHTML = "";

      data.data.forEach(n => {
        const div = document.createElement("div");
        div.style.border = "1px solid black";
        div.style.margin = "10px";
        div.style.padding = "10px";

        div.innerHTML = `
          <h2>${n.title}</h2>
          <p>${n.description}</p>
          <img src="${n.imageUrl}" width="200">
          <p><i>Posted on ${new Date(n.createdAt).toLocaleString()}</i></p>
        `;
        container.appendChild(div);
      });
    }

    loadNews();
    </script>
</body>

</html>